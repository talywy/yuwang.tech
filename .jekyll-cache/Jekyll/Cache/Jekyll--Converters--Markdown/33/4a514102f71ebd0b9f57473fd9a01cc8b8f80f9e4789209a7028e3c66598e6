I" <ul class="toc" id="markdown-toc">
  <li><a href="#intro" id="markdown-toc-intro">0x01 åº</a></li>
  <li><a href="#install" id="markdown-toc-install">0x02 å®‰è£…</a>    <ul>
      <li><a href="#env" id="markdown-toc-env">æœ¬æ–‡ä½¿ç”¨çš„ç¯å¢ƒè¯´æ˜åŠä¾èµ–</a></li>
      <li><a href="#setup" id="markdown-toc-setup">å®‰è£…æ­¥éª¤</a>        <ul>
          <li><a href="#elasticsearch-rtf" id="markdown-toc-elasticsearch-rtf">elasticsearch-rtf å®‰è£…</a></li>
          <li><a href="#elasticsearch-head" id="markdown-toc-elasticsearch-head">elasticsearch-head å®‰è£…</a></li>
          <li><a href="#elasticsearch-bigdesk" id="markdown-toc-elasticsearch-bigdesk">elasticsearch-bigdesk å®‰è£…</a></li>
          <li><a href="#nginx" id="markdown-toc-nginx">nginx</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#begin-use" id="markdown-toc-begin-use">0x03 ä½¿ç”¨</a>    <ul>
      <li><a href="#add-data" id="markdown-toc-add-data">å»ºç«‹ç´¢å¼•å¹¶æ·»åŠ æ•°æ®</a></li>
      <li><a href="#search-data" id="markdown-toc-search-data">æŸ¥è¯¢</a></li>
    </ul>
  </li>
</ul>

<h1 id="intro">0x01 åº</h1>
<p>é¡¹ç›®å¼€å‘ä¸­éœ€è¦ä½¿ç”¨esæ¥è¿›è¡Œä¸€ä¸ªæ–‡æ¡£ç±»ç½‘ç«™çš„å…¨æ–‡æ£€ç´¢å®ç°ï¼Œè®°å½•ç¯å¢ƒæ­å»ºè¿‡ç¨‹ã€‚å¹¶ç»™å‡ºç®€å•demoï¼Œå®ç°ä¸­æ–‡å…³é”®å­—çš„å…¨æ–‡æ£€ç´¢ã€‚</p>

<h1 id="install">0x02 å®‰è£…</h1>

<h2 id="env">æœ¬æ–‡ä½¿ç”¨çš„ç¯å¢ƒè¯´æ˜åŠä¾èµ–</h2>
<ul>
  <li><strong>OS</strong>ï¼š <code class="language-plaintext highlighter-rouge">CentOS release 6.8</code> or <code class="language-plaintext highlighter-rouge">Windows 10</code></li>
  <li><strong>node</strong>:  <code class="language-plaintext highlighter-rouge">v6.9.4(CentOS release 6.8)</code> or <code class="language-plaintext highlighter-rouge">v6.2.0(Windows 10)</code> (å¯é€‰)</li>
  <li><strong>git</strong>: <code class="language-plaintext highlighter-rouge">1.7.1(CentOS release 6.8)</code> or <code class="language-plaintext highlighter-rouge">2.7.0 (Windows 10)</code></li>
  <li><strong>jre</strong>: 1.8</li>
  <li><strong>es</strong>: 5.0 rtfç‰ˆ</li>
</ul>

<h2 id="setup">å®‰è£…æ­¥éª¤</h2>

<h3 id="elasticsearch-rtf">elasticsearch-rtf å®‰è£…</h3>
<p>"ä»€ä¹ˆæ˜¯Elasticsearch-RTFï¼Ÿ RTFæ˜¯Ready To Flyçš„ç¼©å†™ï¼Œåœ¨èˆªæ¨¡é‡Œé¢ï¼Œè¡¨ç¤ºæ— éœ€è‡ªå·±ç»„è£…é›¶ä»¶å³å¯ç›´æ¥ä¸Šæ‰‹å³é£çš„èˆªç©ºæ¨¡å‹ï¼ŒElasticsearch-RTFæ˜¯é’ˆå¯¹ä¸­æ–‡çš„ä¸€ä¸ªå‘è¡Œç‰ˆï¼Œå³ä½¿ç”¨æœ€æ–°ç¨³å®šçš„elasticsearchç‰ˆæœ¬ï¼Œå¹¶ä¸”å¸®ä½ ä¸‹è½½æµ‹è¯•å¥½å¯¹åº”çš„æ’ä»¶ï¼Œå¦‚ä¸­æ–‡åˆ†è¯æ’ä»¶ç­‰ï¼Œç›®çš„æ˜¯è®©ä½ å¯ä»¥ä¸‹è½½ä¸‹æ¥å°±å¯ä»¥ç›´æ¥çš„ä½¿ç”¨ï¼ˆè™½ç„¶eså·²ç»å¾ˆç®€å•äº†ï¼Œä½†æ˜¯å¾ˆå¤šæ–°æ‰‹è¿˜æ˜¯éœ€è¦å»èŠ±æ—¶é—´å»æ‰¾é…ç½®ï¼Œä¸­é—´çš„è¿‡ç¨‹å…¶å®å¾ˆç—›è‹¦ï¼‰ï¼Œå½“ç„¶ç­‰ä½ å¯¹è¿™äº›éƒ½ç†Ÿæ‚‰äº†ä¹‹åï¼Œä½ å®Œå…¨å¯ä»¥è‡ªå·±å»diyäº†ï¼Œè·Ÿlinuxçš„ä¼—å¤šå‘è¡Œç‰ˆæ˜¯ä¸€ä¸ªæ„æ€ã€‚"  â€“ <a href="https://github.com/medcl/elasticsearch-rtf" title="elasticsearch-rtf">https://github.com/medcl/elasticsearch-rtf</a></p>

<ul>
  <li>ä¸‹è½½ç‰ˆæœ¬åŒ…</li>
</ul>

<blockquote>
  <p>git clone git://github.com/medcl/elasticsearch-rtf.git -b master â€“depth 1</p>
</blockquote>

<p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…,å®Œæˆä¸‹è½½</p>
<blockquote>
  <p>cd elasticsearch-rtf</p>
</blockquote>

<ul>
  <li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li>
  <li>vi conf/jvm.optionsä¸­çš„-Xmsä¸-Xmxï¼ˆé»˜è®¤æ˜¯2Gï¼‰</li>
</ul>

<p><img src="/assets/images/posts/begin_es/es_config.png" alt="head plugin" /></p>

<ul>
  <li><strong>ä¿®æ”¹conf/jvm.optionsåŠbin/elasticsearchæ–‡ä»¶çš„ç¼–ç ä¸ºUTF8</strong>ï¼ˆvimä¸­ä½¿ç”¨<code class="language-plaintext highlighter-rouge">:set ff?</code>æŸ¥çœ‹æ–‡ä»¶æ ¼å¼ï¼Œå¦‚æœå‡ºç°fileformaï¼dosåˆ™è¯´æ˜æ–‡ä»¶ç¼–ç æ ¼å¼ä¸å¯¹ï¼Œå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">:set fileformat=unix</code>æ¥ä¿®æ”¹æ–‡ä»¶çš„ç¼–ç ä¸ºæ­£ç¡®æ ¼å¼ï¼‰</li>
  <li>å¯åŠ¨ <strong>æ³¨æ„</strong>: ä½¿ç”¨érootè´¦å·æ¥å¯åŠ¨</li>
</ul>

<blockquote>
  <p>./bin/elasticsearch</p>
</blockquote>

<p>è®¿é—®http://localhost:9200,çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨æ˜å®‰è£…æˆåŠŸ</p>

<p><img src="/assets/images/posts/begin_es/es_index.png" alt="es index" /></p>

<h3 id="elasticsearch-head">elasticsearch-head å®‰è£…</h3>
<p>ç”±äºheadæ’ä»¶åœ¨ES5.xç‰ˆæœ¬ä¸­ä¸å†æ”¯æŒå®‰è£…åœ¨pluginç›®å½•ä¸­ï¼Œæ‰€ä»¥éœ€è¦ç‹¬ç«‹å®‰è£…, æœ‰nodeç‹¬ç«‹è¿è¡Œä»¥åŠä½¿ç”¨nginxä¸¤ç§æ–¹å¼æ¥å®‰è£…headæ’ä»¶ã€‚</p>

<h4>ä½¿ç”¨nodeç‹¬ç«‹è¿è¡Œ</h4>
<p><img src="/assets/images/posts/begin_es/head_plugin.png" alt="head plugin" /></p>

<ul>
  <li>å®‰è£…cnpm
    <ul>
      <li>å®‰è£…è¿‡ç¨‹ä¸­ä¾èµ–nodejsçš„npmåŒ…ç®¡ç†å·¥å…·, é‰´äºå›½å†…æ§½ç³•çš„ç½‘ç»œç¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨æ·˜å®çš„<a href="https://npm.taobao.org/" title="CNPM">cnpm</a>æ¥ä»£æ›¿npmçš„åŠŸèƒ½,å®‰è£…æ–¹æ³•å¦‚ä¸‹:</li>
      <li>å®‰è£…nodejs (ç‰ˆæœ¬è¦æ±‚å‚è€ƒç¯å¢ƒä¾èµ–)</li>
      <li>å®‰è£…cnmp</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>npm install -g cnpm â€“registry=https://registry.npm.taobao.org</p>
</blockquote>

<p>å®‰è£…å®Œä¹‹åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹cnpmç‰ˆæœ¬å·åº”è¯¥&gt;=4.4.2</p>

<blockquote>
  <p>cnpm -v</p>
</blockquote>

<ul>
  <li>ä¸‹è½½es-rtf</li>
</ul>

<blockquote>
  <p>git clone git://github.com/mobz/elasticsearch-head.git</p>
</blockquote>

<ul>
  <li>cd elasticsearch-head</li>
  <li>cnpm install</li>
  <li>å®‰è£…grunt-cli</li>
</ul>

<blockquote>
  <p>cnpm install -g grunt-cli</p>
</blockquote>

<ul>
  <li>grunt server</li>
  <li>open http://localhost:9100/</li>
</ul>

<h4>ä½¿ç”¨nginx</h4>
<p>elasticsearch-headæœ¬èº«æ˜¯ä¸ªé™æ€ç«™ç‚¹ï¼Œå¯ç›´æ¥ä½¿ç”¨nginxå½“åšæœåŠ¡å™¨æ¥ä½¿ç”¨ã€‚</p>

<ul>
  <li>cd /usr/local</li>
</ul>

<blockquote>
  <p>git clone git://github.com/mobz/elasticsearch-head.git</p>
</blockquote>

<p>ç„¶ååœ¨nginxä¸­æ·»åŠ </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location /head {
   alias /usr/local/elasticsearch-head;
}
</code></pre></div></div>

<p>open http://nginx-server/head</p>

<h3 id="elasticsearch-bigdesk">elasticsearch-bigdesk å®‰è£…</h3>
<p>åŸé¡¹ç›®ä½œè€…æœªå‡çº§bigdeskæ’ä»¶ç”¨æ¥æ”¯æŒ5.xç‰ˆæœ¬ï¼Œæ‰€ä»¥ä½¿ç”¨å›½å†…ä¸€ä½œè€…<a href="https://github.com/hlstudio/bigdesk">forkçš„ç‰ˆæœ¬</a>æ¥è¿›è¡Œå®‰è£…</p>

<ul>
  <li>cd /usr/local</li>
</ul>

<blockquote>
  <p>git clone https://github.com/hlstudio/bigdesk.git</p>
</blockquote>

<p>ç„¶ååœ¨nginxä¸­æ·»åŠ </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location /bigdesk {
    alias /usr/local/bigdesk-master/_site;
}
</code></pre></div></div>

<p>open http://nginx-server/bigdesk</p>

<h3 id="nginx">nginx</h3>
<p>ä½¿ç”¨nginxå°†elasticsearchã€elasticsearch-headã€elasticsearch-bigdeskæ•´åˆåœ¨ä¸€èµ·ã€‚</p>

<ul>
  <li>æ·»åŠ ä¸‹é¢çš„nginxé…ç½®åé‡å¯nginx</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> server {

        listen       80;
        server_name  localhost;

        location / {
           proxy_pass http://127.0.0.1:9200;
        }

        location /bigdesk {
           alias /usr/local/bigdesk-master/_site;
        }

        location /head {
           alias /usr/local/elasticsearch-head;
        }

}
</code></pre></div></div>

<ul>
  <li>es http://localhost</li>
  <li>head http://localhost/head</li>
  <li>bigdesl http://localhost/bigdesk</li>
</ul>

<h1 id="begin-use">0x03 ä½¿ç”¨</h1>

<h2 id="add-data">å»ºç«‹ç´¢å¼•å¹¶æ·»åŠ æ•°æ®</h2>

<p><strong>æ³¨æ„</strong>ä¹‹å‰æµ‹è¯•windows cygwä¸‹çš„curlæœ‰ä¸­æ–‡ç¼–ç é—®é¢˜ï¼Œå‘½ä»¤å»ºè®®ä»headæ’ä»¶é¡µé¢ä¸Šè¿›è¡Œæ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/index/doc?pretty' -d '
{
    "url":"http://www.xxx.com/",
    "title":"åŸºæœ¬æ¦‚å¿µ",
    "content":"ä¸€äº›æ–‡ä»¶å†…å†…å®¹çš„åŸºæœ¬æ¦‚å¿µä»‹ç»"
}'
</code></pre></div></div>

<h2 id="search-data">æŸ¥è¯¢</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST 'localhost:9200/index/doc' -d '
{
  "query": {
    "multi_match": {
      "query": "æ¦‚å¿µ",
      "fields": [
        "title",
        "content"
      ]
    }
  },
  "from": 0,
  "size": 5,
  "highlight": {
    "fields": {
      "title": {},
      "content": {}
    }
  }
}'
</code></pre></div></div>

<p>esé›†ç¾¤å®‰è£…å‚è€ƒ<a href="/2017/04/06/es-cluster">ElasticSearch Cluster</a></p>

:ET